<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古巴华人文化传承</title>
    <style>
        :root {
            --beige: #F5E6D3;
            --deep-green: #2F4F4F;
            --vintage-brown: #8B4513;
            --gold: #DAA520;
            --dark-gray: #333333;
            --deep-red: #8B0000;
            --cream: #F5E6D3;
        }
        /* 定义自定义字体 */
        @font-face {
            font-family: 'FZShiGKSJW';
            src: url('../font/FZShiGKSJW.TTF');
        }
        @font-face {
            font-family: 'FZYanSJW_Zhong';
            src: url('../font/FZYanSJW_Zhong.ttf');
        }

        body {
            margin: 0;
            font-family: 'FZShiGKSJW', cursive;
            background-color: var(--beige);
            color: var(--dark-gray);
            margin: 0;
            padding: 0;
            position: relative;
            color: #333;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('assets/history/历史背景图.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -1;
        }

        /* 导航栏样式 */
        .nav {
            background-color: var(--vintage-brown);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }

        .nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            margin: 0;
            padding: 0;
        }

        .nav li {
            margin: 0 2rem;
        }

        .nav a {
            color: var(--beige);
            text-decoration: none;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .nav a:hover {
            color: var(--gold);
        }
        /* === 替换原有音乐控制样式 === */
        .nav .music-control {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .music-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gold);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        /* 播放状态显示为暂停符号 */
        .music-btn.playing::after {
            content: "";
            position: absolute;
            width: 8px;
            height: 24px;
            background: var(--deep-red);
            left: 12px;
            top: 4px;
        }

        /* 暂停状态显示为播放三角形 */
        .music-btn:not(.playing)::after {
            content: "";
            position: absolute;
            border-left: 16px solid var(--deep-red);
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            left: 10px;
            top: 8px;
        }

        /* 主要内容区域 */
        .hero {
            margin-top: 20px;
            height: 100vh;
            background: url('assets/vintage-texture.jpg') center/cover;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;

        }

        /* 保留原大标题样式 */
        .hero-content {
            text-align: center;
            padding: 2rem;
            background: rgba(245, 230, 211, 0.76);
            border-radius: 10px;
            max-width: 800px;
        }

        .hero-title {
            font-size: 3rem;
            color: var(--vintage-brown);
            margin-bottom: 1rem;
        }

        .hero-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .cta-button {
            background-color: var(--deep-green);
            color: var(--beige);
            padding: 1rem 2rem;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'FZYanSJW_Zhong';
        }

        .cta-button:hover {
            background-color: var(--gold);
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
        }

        .modal-content {
            max-width: 100%;
            max-height: 100vh;
            margin: auto;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
        }

        .timeline-container {
            padding-top: 80px;
            min-height: 100vh;
            position: relative;
        }
        /* 蒙版样式 */
        .background-mask {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.5); /* 调整透明度 */
            z-index: 0;
        }
        .timeline {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            padding: 40px 20px;
            z-index: 1;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--deep-green);
            transform: translateX(-50%);
        }

        .timeline-item {
            margin-bottom: 60px;
            position: relative;
            display: flex;
            width: 100%;
            align-items: center; /* 确保内容垂直居中 */
        }

        .timeline-dot {
            width: 20px;
            height: 20px;
            background: var(--gold);
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .timeline-content {
            display: flex;
            flex-direction: column;
            background: none;
            box-shadow: none;
            width: calc(48% - 10px); /* 适当减少宽度，给中线和图片留出空间 */
            justify-content: center; /* 垂直居中 */
            align-items: flex-start; /* 左对齐 */
        }

        .timeline-item.left .timeline-content {
            margin-right: auto;
            text-align: right; /* 右对齐 */
            align-items: flex-end; /* 右对齐 */
        }

        .timeline-item.right .timeline-content {
            margin-left: auto;
            text-align: left; /* 左对齐 */
            align-items: flex-start; /* 左对齐 */
        }

        .history-card {
            display: flex;
            width: auto;
            gap: 20px;
            align-items: center; /* 确保内容垂直居中 */
        }

        .timeline-item.left .history-card {
            flex-direction: row; /* 图片在左，内容在右 */
        }

        .timeline-item.right .history-card {
            flex-direction: row-reverse; /* 图片在右，内容在左 */
        }

        .history-image {
            max-width: 500px;
            height: auto;
            object-fit: contain;
            border-radius: 2px;
            background-color: #fff;
            width: calc(48% - 10px); /* 与内容部分宽度对应 */
        }

        .timeline-content h3 {
            margin: 0;
            display: inline-block;
            align-self: flex-start; /* 左对齐 */
        }

        .timeline-item.left .timeline-content h3 {
            align-self: flex-end; /* 右对齐 */
        }

        .detail-btn {
            background: var(--vintage-brown);
            color: white;
            border: 5px;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            align-self: flex-start; /* 左对齐 */
            display: inline-block;
        }

        .timeline-item.left .detail-btn {
            align-self: flex-end; /* 右对齐 */
        }

        .detail-btn:hover {
            background: var(--gold);
        }

        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            background: rgba(249, 245, 237, 0.881);
            margin: 0 auto;
            padding: 30px;
            width: 90%;
            max-width: 550px;
            border-radius: 8px;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            max-height: 80vh;
            overflow-y: auto;
        }
        /* 新增详情图片样式 */
        .detail-modal .modal-content img {
            display: block; /* 将图片设置为块级元素，便于垂直居中 */
            max-width: 50%; /* 图片最大宽度为模态框宽度 */
            height: auto; /* 高度自适应，保证图片等比例缩放 */
            margin: 15px auto; /* 上下边距为 15px，左右自动居中 */
            border-radius: 4px; /* 图片圆角 */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 图片阴影 */
        }
        .close-btn {
            position: absolute;
            right: 20px;
            top: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .timeline::before {
                left: 20px;
            }

            .timeline-dot {
                left: 12px;
            }

            .timeline-content {
                max-width: 100%;
                margin-left: 50px;
            }

            .history-card {
                flex-direction: column;
            }

            .history-image {
                width: 100%;
            }
        }
            /* 新增时间线项目左右布局样式 */
        .timeline-item.left .history-card {
                flex-direction: row;
            }

        .timeline-item.right .history-card {
                flex-direction: row-reverse;
            }

            @media (max-width: 768px) {
            .timeline-item.left .history-card,
            .timeline-item.right .history-card {
                    flex-direction: column;
                }
            }


    </style>
    
</head>
<body>
    <nav class="nav">
        <ul>
            <li><a href="../index.html">首页</a></li>
            <li><a href="history.html">历史</a></li>
            <li><a href="culture.html">文化</a></li>
            <li><a href="stories.html">华人故事</a></li>
            <!-- 新增音乐控制按钮 -->
            <li class="music-control">
                <button id="music-toggle" class="music-btn paused">
                    <div class="music-icon"></div>
                </button>
            </li>
        </ul>
    </nav>


    <main class="hero">
        <div class="hero-content">
            <h1 class="hero-title">古巴唐人的百年足迹</h1>
            <p class="hero-text">
                从1847年第一批华工抵达古巴开始，近17万华人移民在这片土地上谱写了动人的历史篇章。
                他们用勤劳和智慧，在蔗糖种植园中挥洒汗水，在独立战争中浴血奋战，在商业街区创业打拼。
                今天，让我们一起追溯这段跨越百年的移民史诗，感受古巴唐人的历史。
            </p>
            <button class="cta-button" onclick="location.href='#timeline-container'">探索华人足迹</button>
        </div>
    </main>
    <main class="timeline-container" id="timeline-container">
        <div class="timeline">
            <!-- 1847年：早期移民 -->
            <div class="timeline-item left" data-year="1847-1870">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <h3>契约劳工时期</h3>
                    <br>
                    <button class="detail-btn" onclick="showDetail('1847')">了解更多</button>
                </div>
                <div class="history-image-container">
                    <img src="assets/history/early-migration.jpg" alt="早期华工" class="history-image">
                </div>
            </div>

            <!-- 1870 - 1900：自由移民时期 -->
            <div class="timeline-item right" data-year="1870-1900">
                <div class="timeline-dot"></div>
                <div class="history-card">
                    <img src="assets/history/free-migration.jpg" alt="自由移民" class="history-image">
                </div>
                <div class="timeline-content">
                    <h3>自由移民时期</h3>
                    <br>
                    <button class="detail-btn" onclick="showDetail('1870')">了解更多</button>
                </div>

            </div>

            <!-- 1900 - 1950：社区发展黄金期 -->
            <div class="timeline-item left" data-year="1900-1950">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <h3>社区发展黄金期</h3>
                    <br>
                    <button class="detail-btn" onclick="showDetail('1900')">了解更多</button>
                </div>
                <div class="history-card">
                    <img src="assets/history/golden-age.jpg" alt="社区发展" class="history-image">
                </div>
            </div>

            <!-- 1950 - 1980：政治变革期 -->
            <div class="timeline-item right" data-year="1950-1980">
                <div class="timeline-dot"></div>
                <div class="history-card">
                    <img src="assets/history/revolution-era.jpg" alt="变革时期" class="history-image">
                </div>
                <div class="timeline-content">
                    <h3>政治变革期</h3>
                    <br>
                    <button class="detail-btn" onclick="showDetail('1950')">了解更多</button>
                </div>
            </div>

            <!-- 1980 - 至今：文化复兴 -->
            <div class="timeline-item left" data-year="1980-至今">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <h3>文化复兴时期</h3>
                    <br>
                    <button class="detail-btn" onclick="showDetail('1980')">了解更多</button>
                </div>    
                <div class="history-card">
                    <img src="assets/history/revival.jpg" alt="文化复兴" class="history-image">
                </div>
            </div>
        </div>

        <!-- 详情模态框 -->
        <div class="detail-modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <div id="detail-content"></div>
            </div>
        </div>

        <!-- 蒙版 -->
        <div class="background-mask"></div>
    </main>


    <script>
        // ========= 全局音乐控制 =========
        // 初始化音乐实例（所有页面共用）
        if (!window.persistentMusic) {
            window.persistentMusic = new Audio('../bgm/华风古巴韵-2.mp3');
            window.persistentMusic.loop = true;

            // 判断是否全新加载页面（通过外部链接打开）
            const navigationEntry = performance.getEntriesByType("navigation")[0];
            const isNewVisit = navigationEntry?.type === 'navigate';

            if (isNewVisit) {
                localStorage.setItem('musicTime', 0);
                window.persistentMusic.currentTime = 0;
            } else {
                const savedTime = localStorage.getItem('musicTime') || 0;
                window.persistentMusic.currentTime = savedTime;
            }

            const isPlaying = localStorage.getItem('musicPlaying') === 'true';
            if (isPlaying) {
                window.persistentMusic.play().catch(() => {});
                document.getElementById('music-toggle').classList.add('playing');
            }
        }

        // 音乐按钮控制
        document.getElementById('music-toggle').addEventListener('click', function() {
            if (window.persistentMusic.paused) {
                window.persistentMusic.play();
                this.classList.add('playing');
                localStorage.setItem('musicPlaying', 'true');
            } else {
                window.persistentMusic.pause();
                this.classList.remove('playing');
                localStorage.setItem('musicPlaying', 'false');
            }
        });

        // 自动播放处理（首页互动后自动播放）
        document.addEventListener('click', function initPlay() {
            if (window.persistentMusic.paused) {
                window.persistentMusic.play()
                    .then(() => {
                        document.getElementById('music-toggle').classList.add('playing');
                        localStorage.setItem('musicPlaying', 'true');
                    })
                    .catch(() => {});
            }
            document.removeEventListener('click', initPlay);
        }, { once: true });

        // 保存播放状态
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('musicTime', window.persistentMusic.currentTime);
            localStorage.setItem('musicPlaying', !window.persistentMusic.paused);
        });

        let currentSection = 0;
        const sections = document.querySelectorAll('.story-section');
        let isAnimating = false;

        function scrollToSection(index) {
            if (isAnimating || index < 0 || index >= sections.length) return;

            isAnimating = true;

            sections[currentSection].classList.remove('active');
            sections[currentSection].style.transform = 'translateY(-100%)';

            currentSection = index;

            sections[currentSection].style.transform = 'translateY(0)';
            sections[currentSection].classList.add('active');

            setTimeout(() => {
                isAnimating = false;
            }, 800);
        }

        window.addEventListener('wheel', function (e) {
            if (document.querySelector('.fullpage-container').style.display === 'block') {
                if (e.deltaY > 0) {
                    // 向下滚动
                    scrollToSection(currentSection + 1);
                } else {
                    // 向上滚动
                    scrollToSection(currentSection - 1);
                }
            }
        });

        // 添加触摸支持
        let touchStartY = 0;
        window.addEventListener('touchstart', function (e) {
            touchStartY = e.touches[0].clientY;
        });

        window.addEventListener('touchmove', function (e) {
            if (document.querySelector('.fullpage-container').style.display === 'block') {
                const touchEndY = e.touches[0].clientY;
                const diff = touchStartY - touchEndY;

                if (Math.abs(diff) > 50) { // 最小滑动距离
                    if (diff > 0) {
                        scrollToSection(currentSection + 1);
                    } else {
                        scrollToSection(currentSection - 1);
                    }
                    touchStartY = touchEndY;
                }
            }
        });

        function openModal(element) {
            const modal = document.querySelector('.modal');
            const modalImg = document.getElementById('modal-img');
            const img = element.querySelector('.gallery-image');

            modal.style.display = "block";
            modalImg.src = img.src;
            modalImg.alt = img.alt;

            modal.onclick = function () {
                modal.style.display = "none";
            }
        }

        function openStory(storyId) {
            // 这里可以添加打开详细故事页面的逻辑
            console.log(`Opening story ${storyId}`);
        }

        function showDetail(year) {
            const modal = document.querySelector('.detail-modal');
            const content = document.getElementById('detail-content');

            const details = {
                '1847': {
                    title: '契约劳工时期',
                    content: `
                        <h2>1847 - 1870：早期华工移民</h2>
                        <img src="assets/history/early-migration.jpg" alt="早期华工">
                        <p>英国废除奴隶贸易（1807年）后，西班牙为填补古巴甘蔗园劳动力缺口，转向中国招募"契约劳工"。华工多来自广东四邑（台山、开平、恩平、新会），招聘的人说去古巴种甘蔗，八年期满给十亩地，顿顿吃白米饭！签订8年合同，首批206名华工实际沦为变相奴隶。1847年首批"苦力船"抵达古巴，西班牙商船"奥坎多号"载首批206名华工抵达哈瓦那雷加拉港，标志着古巴契约华工时代的开端。货舱里206个男人，都是被"契约"二字骗上船的。当铁链锁住舱门时，他们才看清所谓"合同"竟是卖身契：每天劳作18小时，逃跑者鞭刑至死。西班牙监工提着煤油灯晃过，火光映出舱壁刻满的汉字，有人用指甲抠出"开平李二狗卒于此"，有人画了幅故乡的碉楼。船程未过半因霍乱，高烧的劳工会被抛弃，被鲨鱼啃食。抵达种植园后的长时间工作也只能靠着意志坚持下去。</p>
                        <div style="text-align: right; margin-top: 20px;">
                            <a href="http://xhslink.com/a/ggByIwiP7yt8" target="_blank" style="background-color: var(--vintage-brown); color: var(--beige); padding: 8px 15px; text-decoration: none; border-radius: 5px; display: inline-block;">了解更多</a>
                        </div>
                    `
                },
                '1870': {
                    title: '自由移民时期',
                    content: `
                        <h2>1870 - 1900：自由移民时期</h2>
                        <img src="assets/history/free-migration.jpg" alt="自由移民">
                        <p>1847年后古巴以契约劳工为主，1874年清政府禁止苦力贸易后，部分自由华工转向商业、手工业，形成早期华人社区。</p>
                        <p>殖民政府推行"漂白政策"，鼓励西班牙人移民以巩固统治，多数从事行政、商业和农业。邻近岛屿自由劳工（如牙买加、海地）填补种植园空缺；获解放的非洲裔向城市迁移，但仍受种族压迫。</p>
                        <p>不同地区的移民汇集在这里，华人饮食、非洲音乐与宗教、西班牙传统交织，形成多元文化底色。自由劳工逐步取代奴隶制，推动雇佣制发展，但剥削问题持续。</p>
                        <p>1879年古巴的自由移民现象是殖民经济转型、战争动荡与全球劳动力流动共同作用的结果。移民不仅重塑了古巴人口结构和文化，也为独立运动埋下火种，成为理解现代古巴社会形成的关键线索。</p>
                    `
                },
                '1900': {
                    title: '社区发展黄金期',
                    content: `
                        <h2>1900 - 1950：社区发展黄金期</h2>
                        <img src="assets/history/golden-age.jpg" alt="社区发展">
                        <p>古巴华人社区的黄金时期大致从19世纪末延续至20世纪中期，这一时期华人从契约劳工转型为商人、手工业者和文化传播者，社区规模和社会影响力达到巅峰。</p>
                        <p>1922年，《华文商报》创刊，成为古巴首份中文报纸，传播中国新闻与商业信息。1940年代，《民声日报》《开明公报》等相继发行，推动文化传承。</p>
                        <p>华人学校如"中华学校"教授中文和传统文化，维系年轻一代的文化认同。洪门致公堂、龙冈亲义总公所等秘密社团转型为公开的互助组织，举办慈善活动。</p>
                        <p>春节舞龙舞狮、中秋灯会吸引古巴民众参与，成为哈瓦那的文化盛事。二战期间，华人社区组织"抗日救国会"，募捐支援中国抗战，同时参与古巴本土反法西斯活动。</p>
                        <p>古巴华人被视作全球华人团结抗敌的典范，提升社区的国际形象。</p>
                    `
                },
                '1950': {
                    title: '政治变革期',
                    content: `
                        <h2>1950 - 1980：政治变革期</h2>
                        <img src="assets/history/revolution-era.jpg" alt="变革时期">
                        <p>这一时期的政治变革导致许多华人选择离开古巴，华人社区规模开始逐渐缩小。但仍有部分华人选择留下，潘松年，50年代来到古巴，接手了一家杂货铺，多年经营小有积蓄，没想到1959年之后，全部化为泡影。如今的潘松年，每个月靠着10美元的退休金生活，与几个老华侨在一起，曾经中国的弟弟提出接他回国养老，也寄来了机票钱，但老人却说"人还是要活得有脸面"，虽然生活窘迫，但他还是不愿意回国用别人的钱，这种曾经一夜之间带来的巨大伤痛背后，是和潘老一样的十万多华人共同的命运，落魄又无助的羞耻感。</p>
                        <div style="text-align: right; margin-top: 20px;">
                            <a href="http://xhslink.com/a/ElgAjV4WC7p8" target="_blank" style="background-color: var(--vintage-brown); color: var(--beige); padding: 8px 15px; text-decoration: none; border-radius: 5px; display: inline-block;">了解更多</a>
                        </div>
                    `
                },
                '1980': {
                    title: '文化复兴时期',
                    content: `
                        <h2>1980 - 至今：文化复兴时期</h2>
                        <img src="assets/history/revival.jpg" alt="文化复兴">
                        <p>19世纪末至20世纪中叶，古巴经历了一段融合移民浪潮、民族觉醒与文化创新的特殊历史时期，塑造了现代国家的多元底色。</p>
                        <p>经济与社会转型方面，1879年前后自由移民（华人、西班牙人、加勒比劳工）填补奴隶制瓦解后的劳动力缺口，推动种植园经济向雇佣制过渡，华人社区更在20世纪初黄金期发展为西半球最大侨社，商业与文化影响力深远。</p>
                        <p>独立战争与民族意识催化了文化复兴，何塞·马蒂等思想家以反殖民文学重构"古巴人"身份，黑人文化运动将非洲传统融入诗歌与音乐，颂乐、萨尔萨等混血艺术风靡全球。</p>
                        <p>文化觉醒的独特性在于打破欧洲中心，以非洲、亚洲移民文化为根基，通过文学、音乐与视觉艺术（如尼古拉斯·纪廉的诗歌、维尔弗雷多·林的绘画）构建"混血古巴"认同。</p>
                        <p>这一过程既是殖民遗产的反思，也是移民贡献与本土抗争的交织，最终形成古巴独特的文化软实力，至今影响其艺术与国族叙事。</p>
                    `
                }
            };

            content.innerHTML = details[year]?.content || '内容加载中...';
            modal.style.display = 'block';
        }

        // 关闭模态框
        document.querySelector('.close-btn').onclick = function () {
            document.querySelector('.detail-modal').style.display = 'none';
        }

        // 获取时间线容器和蒙版元素
        const timelineContainer = document.querySelector('.timeline-container');
        const backgroundMask = document.querySelector('.background-mask');

        // 监听窗口滚动事件
        window.addEventListener('scroll', function () {
            const timelineTop = timelineContainer.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;

            if (timelineTop < windowHeight) {
                // 时间线进入可视区域，显示蒙版
                backgroundMask.style.display = 'block';
            } else {
                // 时间线离开可视区域，隐藏蒙版
                backgroundMask.style.display = 'none';
            }
        });
    </script>
</body>
</html>